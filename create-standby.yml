###############################################################################
# Oracle Physical Standby Creation Pipeline
# GitHub Actions â†’ Ansible Playbooks (via self-hosted runner on Ansible control node)
###############################################################################
name: "Oracle Physical Standby Creation"

on:
  repository_dispatch:
    types: [create-physical-standby]

env:
  PIPELINE_URL: "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"

jobs:

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # INIT: Parse config from dispatch payload
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  init:
    name: "ğŸ“‹ Initialize"
    runs-on: ubuntu-latest
    outputs:
      primary_host: ${{ steps.p.outputs.primary_host }}
      primary_sid: ${{ steps.p.outputs.primary_sid }}
      standby_host: ${{ steps.p.outputs.standby_host }}
      standby_sid: ${{ steps.p.outputs.standby_sid }}
      rman_method: ${{ steps.p.outputs.rman_method }}
      email_to: ${{ steps.p.outputs.email_to }}
      start_mrp: ${{ steps.p.outputs.start_mrp }}
      ap1: ${{ steps.p.outputs.ap1 }}
      ap2: ${{ steps.p.outputs.ap2 }}
      ap3: ${{ steps.p.outputs.ap3 }}
      ap4: ${{ steps.p.outputs.ap4 }}
    steps:
      - name: Parse
        id: p
        run: |
          P='${{ toJson(github.event.client_payload) }}'
          echo "primary_host=$(echo $P|jq -r '.primary.host')" >> $GITHUB_OUTPUT
          echo "primary_sid=$(echo $P|jq -r '.primary.sid')" >> $GITHUB_OUTPUT
          echo "standby_host=$(echo $P|jq -r '.standby.host')" >> $GITHUB_OUTPUT
          echo "standby_sid=$(echo $P|jq -r '.standby.sid')" >> $GITHUB_OUTPUT
          echo "rman_method=$(echo $P|jq -r '.rman.method')" >> $GITHUB_OUTPUT
          echo "email_to=$(echo $P|jq -r '.notifications.email_to')" >> $GITHUB_OUTPUT
          echo "start_mrp=$(echo $P|jq -r '.options.start_mrp')" >> $GITHUB_OUTPUT
          echo "ap1=$(echo $P|jq -r '.approvals.gate_precheck')" >> $GITHUB_OUTPUT
          echo "ap2=$(echo $P|jq -r '.approvals.gate_primary')" >> $GITHUB_OUTPUT
          echo "ap3=$(echo $P|jq -r '.approvals.gate_rman')" >> $GITHUB_OUTPUT
          echo "ap4=$(echo $P|jq -r '.approvals.gate_golive')" >> $GITHUB_OUTPUT

      - name: Summary
        run: |
          echo "Primary: ${{ steps.p.outputs.primary_host }}/${{ steps.p.outputs.primary_sid }}"
          echo "Standby: ${{ steps.p.outputs.standby_host }}/${{ steps.p.outputs.standby_sid }}"
          echo "Method:  ${{ steps.p.outputs.rman_method }}"

      # Save config to artifact for Ansible jobs to pick up
      - name: Save Config Artifact
        run: echo '${{ toJson(github.event.client_payload) }}' > config.json
      - uses: actions/upload-artifact@v4
        with:
          name: standby-config
          path: config.json

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 1: Pre-Flight Checks
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  preflight:
    name: "ğŸ” Pre-Flight Checks"
    needs: init
    runs-on: [self-hosted, ansible]
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with: { name: standby-config }

      - name: Run Ansible Pre-Flight
        run: |
          cd ansible
          ansible-playbook -i inventory/hosts.yml \
            playbooks/01_preflight.yml \
            -e "@../config.json" \
            -e "ansible_ssh_private_key_file=${{ secrets.SSH_PRIVATE_KEY_PATH }}" \
            -e "oracle_sys_password=${{ secrets.ORACLE_SYS_PASSWORD }}"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # NOTIFY: Pre-Flight
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  notify_preflight:
    name: "ğŸ“§ Notify Pre-Flight"
    needs: [init, preflight]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Send Email
        uses: dawidd6/action-send-mail@v3
        if: needs.init.outputs.email_to != ''
        with:
          server_address: ${{ secrets.SMTP_SERVER }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASSWORD }}
          subject: "[${{ needs.preflight.result == 'success' && 'âœ…' || 'âŒ' }}] Standby Pre-Flight - ${{ needs.init.outputs.primary_sid }} â†’ ${{ needs.init.outputs.standby_sid }}"
          to: ${{ needs.init.outputs.email_to }}
          from: ${{ secrets.SMTP_FROM }}
          body: |
            Oracle Physical Standby Creation Pipeline
            ============================================
            Stage: Pre-Flight Checks
            Status: ${{ needs.preflight.result }}
            Primary: ${{ needs.init.outputs.primary_host }}/${{ needs.init.outputs.primary_sid }}
            Standby: ${{ needs.init.outputs.standby_host }}/${{ needs.init.outputs.standby_sid }}
            Pipeline: ${{ env.PIPELINE_URL }}

      - name: Slack Notification
        if: secrets.SLACK_WEBHOOK != ''
        run: |
          curl -X POST "${{ secrets.SLACK_WEBHOOK }}" \
            -H 'Content-type: application/json' \
            -d '{"text":"Pre-Flight ${{ needs.preflight.result }}: ${{ needs.init.outputs.primary_sid }} â†’ ${{ needs.init.outputs.standby_sid }}\n${{ env.PIPELINE_URL }}"}'

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # GATE 1: Approve Pre-Flight
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  gate1:
    name: "ğŸ” Gate 1: Pre-Flight"
    needs: [init, preflight, notify_preflight]
    if: needs.init.outputs.ap1 == 'true' && needs.preflight.result == 'success'
    runs-on: ubuntu-latest
    environment: preflight-approval
    steps:
      - run: echo "âœ… Approved"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 2: Configure Primary
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  configure_primary:
    name: "âš™ï¸ Configure Primary"
    needs: [init, preflight, gate1]
    if: always() && needs.preflight.result == 'success' && (needs.gate1.result == 'success' || needs.init.outputs.ap1 != 'true')
    runs-on: [self-hosted, ansible]
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with: { name: standby-config }

      - name: Run Ansible Configure Primary
        run: |
          cd ansible
          ansible-playbook -i inventory/hosts.yml \
            playbooks/02_configure_primary.yml \
            -e "@../config.json" \
            -e "oracle_sys_password=${{ secrets.ORACLE_SYS_PASSWORD }}"

  notify_primary:
    name: "ğŸ“§ Notify Primary"
    needs: [init, configure_primary]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Send Email
        uses: dawidd6/action-send-mail@v3
        if: needs.init.outputs.email_to != ''
        with:
          server_address: ${{ secrets.SMTP_SERVER }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASSWORD }}
          subject: "[${{ needs.configure_primary.result == 'success' && 'âœ…' || 'âŒ' }}] Primary Configured - ${{ needs.init.outputs.primary_sid }}"
          to: ${{ needs.init.outputs.email_to }}
          from: ${{ secrets.SMTP_FROM }}
          body: |
            Stage: Configure Primary Database
            Status: ${{ needs.configure_primary.result }}
            Pipeline: ${{ env.PIPELINE_URL }}

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # GATE 2: Approve Primary Changes
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  gate2:
    name: "ğŸ” Gate 2: Primary Changes"
    needs: [init, configure_primary, notify_primary]
    if: needs.init.outputs.ap2 == 'true' && needs.configure_primary.result == 'success'
    runs-on: ubuntu-latest
    environment: primary-approval
    steps:
      - run: echo "âœ… Approved"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 3: Prepare Standby + NOMOUNT
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  prepare_standby:
    name: "ğŸ—ï¸ Prepare Standby & NOMOUNT"
    needs: [init, configure_primary, gate2]
    if: always() && needs.configure_primary.result == 'success' && (needs.gate2.result == 'success' || needs.init.outputs.ap2 != 'true')
    runs-on: [self-hosted, ansible]
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with: { name: standby-config }

      - name: Run Ansible Prepare Standby
        run: |
          cd ansible
          ansible-playbook -i inventory/hosts.yml \
            playbooks/03_prepare_standby.yml \
            -e "@../config.json" \
            -e "oracle_sys_password=${{ secrets.ORACLE_SYS_PASSWORD }}"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # GATE 3: Approve RMAN
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  gate3:
    name: "ğŸ” Gate 3: RMAN Duplicate"
    needs: [init, prepare_standby]
    if: needs.init.outputs.ap3 == 'true' && needs.prepare_standby.result == 'success'
    runs-on: ubuntu-latest
    environment: rman-approval
    steps:
      - run: echo "âœ… Approved"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 4: RMAN Duplicate
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  rman_duplicate:
    name: "ğŸ’¾ RMAN Duplicate"
    needs: [init, prepare_standby, gate3]
    if: always() && needs.prepare_standby.result == 'success' && (needs.gate3.result == 'success' || needs.init.outputs.ap3 != 'true')
    runs-on: [self-hosted, ansible]
    timeout-minutes: 1440
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with: { name: standby-config }

      - name: Run Ansible RMAN Duplicate
        run: |
          cd ansible
          ansible-playbook -i inventory/hosts.yml \
            playbooks/04_rman_duplicate.yml \
            -e "@../config.json" \
            -e "oracle_sys_password=${{ secrets.ORACLE_SYS_PASSWORD }}"

  notify_rman:
    name: "ğŸ“§ Notify RMAN"
    needs: [init, rman_duplicate]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Send Email
        uses: dawidd6/action-send-mail@v3
        if: needs.init.outputs.email_to != ''
        with:
          server_address: ${{ secrets.SMTP_SERVER }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASSWORD }}
          subject: "[${{ needs.rman_duplicate.result == 'success' && 'âœ…' || 'âŒ' }}] RMAN Duplicate ${{ needs.rman_duplicate.result }} - ${{ needs.init.outputs.standby_sid }}"
          to: ${{ needs.init.outputs.email_to }}
          from: ${{ secrets.SMTP_FROM }}
          body: |
            Stage: RMAN Duplicate (${{ needs.init.outputs.rman_method }})
            Status: ${{ needs.rman_duplicate.result }}
            Standby: ${{ needs.init.outputs.standby_host }}/${{ needs.init.outputs.standby_sid }}
            Pipeline: ${{ env.PIPELINE_URL }}

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 5: Post-Config + Start MRP
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  post_config:
    name: "âš™ï¸ Post Config & Start MRP"
    needs: [init, rman_duplicate]
    if: needs.rman_duplicate.result == 'success'
    runs-on: [self-hosted, ansible]
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with: { name: standby-config }

      - name: Run Ansible Post Config
        run: |
          cd ansible
          ansible-playbook -i inventory/hosts.yml \
            playbooks/05_post_config.yml \
            -e "@../config.json" \
            -e "oracle_sys_password=${{ secrets.ORACLE_SYS_PASSWORD }}"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # GATE 4: Go-Live
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  gate4:
    name: "ğŸ” Gate 4: Go-Live"
    needs: [init, post_config]
    if: needs.init.outputs.ap4 == 'true' && needs.post_config.result == 'success'
    runs-on: ubuntu-latest
    environment: golive-approval
    steps:
      - run: echo "âœ… Approved"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAGE 6: Validation
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  validation:
    name: "âœ… Validation"
    needs: [init, post_config, gate4]
    if: always() && needs.post_config.result == 'success' && (needs.gate4.result == 'success' || needs.init.outputs.ap4 != 'true')
    runs-on: [self-hosted, ansible]
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with: { name: standby-config }

      - name: Run Ansible Validation
        run: |
          cd ansible
          ansible-playbook -i inventory/hosts.yml \
            playbooks/06_validation.yml \
            -e "@../config.json" \
            -e "oracle_sys_password=${{ secrets.ORACLE_SYS_PASSWORD }}"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # FINAL NOTIFICATION
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  notify_final:
    name: "ğŸ“§ Final Report"
    needs: [init, preflight, configure_primary, prepare_standby, rman_duplicate, post_config, validation]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - name: Send Final Email
        uses: dawidd6/action-send-mail@v3
        if: needs.init.outputs.email_to != ''
        with:
          server_address: ${{ secrets.SMTP_SERVER }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASSWORD }}
          subject: "[${{ needs.validation.result == 'success' && 'âœ… SUCCESS' || 'âŒ FAILED' }}] Standby Creation Complete - ${{ needs.init.outputs.standby_sid }}"
          to: ${{ needs.init.outputs.email_to }}
          from: ${{ secrets.SMTP_FROM }}
          body: |
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            ORACLE PHYSICAL STANDBY - FINAL REPORT
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

            Primary:   ${{ needs.init.outputs.primary_host }}/${{ needs.init.outputs.primary_sid }}
            Standby:   ${{ needs.init.outputs.standby_host }}/${{ needs.init.outputs.standby_sid }}
            Method:    ${{ needs.init.outputs.rman_method }}

            STAGE RESULTS:
            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            Pre-Flight:      ${{ needs.preflight.result }}
            Primary Config:  ${{ needs.configure_primary.result }}
            Prepare Standby: ${{ needs.prepare_standby.result }}
            RMAN Duplicate:  ${{ needs.rman_duplicate.result }}
            Post Config:     ${{ needs.post_config.result }}
            Validation:      ${{ needs.validation.result }}
            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

            Pipeline: ${{ env.PIPELINE_URL }}

      - name: Slack Final
        if: secrets.SLACK_WEBHOOK != ''
        run: |
          STATUS="${{ needs.validation.result == 'success' && 'âœ… SUCCESS' || 'âŒ FAILED' }}"
          curl -X POST "${{ secrets.SLACK_WEBHOOK }}" \
            -H 'Content-type: application/json' \
            -d "{\"text\":\"${STATUS}: Standby ${{ needs.init.outputs.standby_sid }} creation complete\nPrimary: ${{ needs.init.outputs.primary_sid }}\nPipeline: ${{ env.PIPELINE_URL }}\"}"
